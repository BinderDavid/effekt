module examples/pos/withstatement

import immutable/list

effect Exc[A](msg: String): A

def printer { p: Unit / Exc }: Unit / Console = try { p() } with {
    case Exc(msg) => println(msg)
}


def user(): Unit / Console = {
    with printer;
    with x = foreach([1,2,3]);
    println(x);
    val z = {
        val x = 2;
        println("hello " ++ show(x))
    };
    do Exc[Unit]("raised exception");
    println("world")
}

def main() = user()